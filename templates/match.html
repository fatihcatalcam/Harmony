<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Harmony - Find Profiles</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
    rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#1db954',
            dark: '#0b1117',
            card: '#121212',
          }
        }
      }
    }
  </script>
  <script src="https://cdn.jsdelivr.net/npm/interactjs/dist/interact.min.js"></script>
  <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
  <meta name="csrf-token" content="{{ csrf_token() }}">
  <style>
    :root {
      --primary: #1db954;
      --primary-dark: #169943;
      --background: #0b1117;
      --background-soft: rgba(11, 17, 23, 0.7);
      --card: rgba(18, 18, 18, 0.85);
      --border: rgba(255, 255, 255, 0.08);
      --text: #f5f5f5;
      --muted: rgba(245, 245, 245, 0.75);
      --accent: #4dd0e1;
      --gradient: linear-gradient(135deg, rgba(29, 185, 84, 0.9), rgba(18, 18, 18, 0.95));
    }

    body {
      font-family: 'Poppins', sans-serif;
      background: var(--background);
      color: var(--text);
    }

    /* Background Glows (Matching index1.html) */
    body::before,
    body::after {
      content: "";
      position: fixed;
      width: 420px;
      height: 420px;
      border-radius: 50%;
      filter: blur(140px);
      z-index: -2;
      opacity: 0.55;
    }

    body::before {
      background: rgba(29, 185, 84, 0.5);
      top: -160px;
      left: -120px;
    }

    body::after {
      background: rgba(77, 208, 225, 0.4);
      bottom: -180px;
      right: -140px;
    }

    /* Animation Styles */
    @keyframes growHeart {
      0% {
        transform: translate(-50%, -50%) scale(0);
        opacity: 0;
      }

      50% {
        transform: translate(-50%, -50%) scale(1.2);
        opacity: 1;
      }

      100% {
        transform: translate(-50%, -50%) scale(1);
        opacity: 0;
      }
    }

    .heart-animation {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0);
      font-size: 5rem;
      color: white;
      pointer-events: none;
      z-index: 2000;
      animation: growHeart 1s ease-in-out forwards;
    }

    @keyframes growMatch {
      0% {
        transform: translate(-50%, -50%) scale(0);
        opacity: 0;
      }

      50% {
        transform: translate(-50%, -50%) scale(1.5);
        opacity: 1;
      }

      100% {
        transform: translate(-50%, -50%) scale(1);
        opacity: 0;
      }
    }

    .match-animation {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0);
      font-size: 3em;
      color: white;
      font-weight: bold;
      pointer-events: none;
      z-index: 2000;
      animation: growMatch 1s ease-in-out forwards;
    }

    @keyframes growCross {
      0% {
        transform: translate(-50%, -50%) scale(0);
        opacity: 0;
      }

      50% {
        transform: translate(-50%, -50%) scale(1.2);
        opacity: 1;
      }

      100% {
        transform: translate(-50%, -50%) scale(1);
        opacity: 0;
      }
    }

    .cross-animation {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0);
      font-size: 5rem;
      color: red;
      pointer-events: none;
      z-index: 2000;
      animation: growCross 1s ease-in-out forwards;
    }

    @keyframes spinStar {
      0% {
        transform: translate(-50%, -50%) scale(0) rotate(0deg);
        opacity: 0;
      }

      50% {
        transform: translate(-50%, -50%) scale(1.5) rotate(180deg);
        opacity: 1;
      }

      100% {
        transform: translate(-50%, -50%) scale(1) rotate(360deg);
        opacity: 0;
      }
    }

    .star-animation {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0);
      font-size: 5rem;
      color: #3b82f6;
      pointer-events: none;
      z-index: 2000;
      animation: spinStar 1s ease-in-out forwards;
    }

    .scrollbar-hide::-webkit-scrollbar {
      display: none;
    }

    .scrollbar-hide {
      -ms-overflow-style: none;
      scrollbar-width: none;
    }

    /* Custom Button Styles to Match Index1 */
    .btn-primary-custom {
      background: var(--primary);
      color: #fff;
      box-shadow: 0 12px 28px rgba(29, 185, 84, 0.25);
    }

    .btn-primary-custom:hover {
      background: var(--primary-dark);
      transform: translateY(-2px) scale(1.02);
    }
  </style>
</head>

<body class="min-h-screen flex flex-col relative overflow-x-hidden">

  <header class="w-full px-[7vw] py-6 flex justify-between items-center sticky top-0 z-40 border-b border-white/5"
    style="background: linear-gradient(180deg, rgba(11, 17, 23, 0.92) 0%, rgba(11, 17, 23, 0) 100%); backdrop-filter: blur(18px);">
    <a href="/index1" class="text-3xl font-bold tracking-tight flex items-center gap-3 text-white">
      <span class="flex items-center justify-center w-10 h-10 rounded-full shadow-lg shadow-emerald-500/30 text-xl"
        style="background: var(--gradient);">â™«</span>
      Harmony
    </a>
    <div class="flex items-center gap-4">
      <a href="/profile">
        <img id="profile-pic"
          class="w-12 h-12 rounded-full border-2 border-white/10 object-cover hover:scale-105 transition shadow-lg shadow-emerald-500/20"
          src="{{ profile_picture_url or 'https://placehold.co/50x50' }}" alt="Profile Picture"
          style="box-shadow: 0 0 0 4px rgba(29, 185, 84, 0.2);">
      </a>
      <button onclick="toggleFilter()"
        class="flex items-center gap-2 px-5 py-3 bg-white/10 hover:bg-white/15 text-white rounded-full font-semibold transition border border-white/10 checkbox-btn">
        <i class="fas fa-sliders-h"></i> <span class="hidden sm:inline">Filters</span>
      </button>
      <a href="/logout"
        class="flex items-center gap-2 px-6 py-3 rounded-full font-semibold transition btn-primary-custom">
        Logout
      </a>
    </div>
  </header>

  <!-- Filter Modal -->
  <div id="filter-modal" class="fixed inset-0 z-50 hidden" aria-labelledby="modal-title" role="dialog"
    aria-modal="true">
    <div class="absolute inset-0 bg-black/90 backdrop-blur-md transition-opacity opacity-0 opacity-100-on-show"
      onclick="toggleFilter()"></div>
    <div class="absolute inset-0 flex items-center justify-center p-4 pointer-events-none">
      <div
        class="border border-white/10 rounded-3xl w-full max-w-md shadow-2xl transform transition-all scale-95 opacity-0 scale-100-on-show opacity-100-on-show relative overflow-hidden pointer-events-auto"
        style="background: var(--card);">
        <div class="px-6 py-5 border-b border-white/10 flex justify-between items-center bg-white/5">
          <h3 class="text-xl font-bold text-white flex items-center gap-2">
            <i class="fas fa-filter text-emerald-400"></i> Filter Profiles
          </h3>
          <button onclick="toggleFilter()"
            class="text-gray-400 hover:text-white transition w-8 h-8 flex items-center justify-center rounded-full hover:bg-white/10">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="p-6 space-y-6">
          <form action="/find-profiles" method="GET" class="space-y-5">
            <div>
              <label class="block text-sm font-medium text-gray-400 mb-2">Age Range</label>
              <div class="flex gap-4 items-center">
                <input type="number" name="min_age" placeholder="18" min="18" max="100"
                  class="w-full bg-[#1a1a1a] border border-white/10 rounded-xl px-4 py-3 text-white placeholder-gray-600 focus:outline-none focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 transition"
                  value="{{ request.args.get('min_age', '') }}">
                <span class="text-gray-500">-</span>
                <input type="number" name="max_age" placeholder="50" min="18" max="100"
                  class="w-full bg-[#1a1a1a] border border-white/10 rounded-xl px-4 py-3 text-white placeholder-gray-600 focus:outline-none focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 transition"
                  value="{{ request.args.get('max_age', '') }}">
              </div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-400 mb-2">Location</label>
              <div class="relative">
                <i class="fas fa-map-marker-alt absolute left-4 top-1/2 -translate-y-1/2 text-gray-500"></i>
                <input type="text" name="location" placeholder="City, Country"
                  class="w-full bg-[#1a1a1a] border border-white/10 rounded-xl pl-11 pr-4 py-3 text-white placeholder-gray-600 focus:outline-none focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 transition"
                  value="{{ request.args.get('location', '') }}">
              </div>
            </div>
            <button type="submit"
              class="w-full py-3.5 rounded-xl font-bold transform transition hover:-translate-y-0.5 mt-2 btn-primary-custom">Apply
              Filters</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <script>
    function toggleFilter() {
      const modal = document.getElementById('filter-modal');
      const backdrop = modal.querySelector('div:first-child');
      const panel = modal.querySelector('div:nth-child(2) > div');
      if (modal.classList.contains('hidden')) {
        modal.classList.remove('hidden');
        requestAnimationFrame(() => {
          backdrop.classList.remove('opacity-0'); backdrop.classList.add('opacity-100');
          panel.classList.remove('scale-95', 'opacity-0'); panel.classList.add('scale-100', 'opacity-100');
        });
      } else {
        backdrop.classList.remove('opacity-100'); backdrop.classList.add('opacity-0');
        panel.classList.remove('scale-100', 'opacity-100'); panel.classList.add('scale-95', 'opacity-0');
        setTimeout(() => { modal.classList.add('hidden'); }, 200);
      }
    }
  </script>

  <main
    class="flex-1 flex flex-col items-center justify-center p-4 gap-6 w-full max-w-7xl mx-auto h-[calc(100vh-80px)] overflow-hidden">
    <section class="flex flex-col items-center gap-2 w-full h-full justify-center">

      <!-- tinder-container with select-none to prevent text selection -->
      <div class="tinder-container relative w-full max-w-sm h-[650px] rounded-3xl select-none">
        <div id="profiles-container" class="relative w-full h-full">
          {% if no_profiles %}
          <div
            class="no-profiles flex flex-col items-center justify-center h-full text-center p-8 rounded-3xl border border-white/10 shadow-2xl"
            style="background: var(--card);">
            <div class="w-20 h-20 bg-white/5 rounded-full flex items-center justify-center mb-4 text-3xl">ðŸ˜¢</div>
            <h2 class="text-2xl font-bold text-white mb-2">No Matches Found</h2>
            <p class="text-gray-400">Try adjusting your filters!</p>
            <button onclick="toggleFilter()" class="mt-6 text-emerald-400 hover:text-emerald-300 font-semibold">Broaden
              Filters</button>
          </div>
          {% else %}
          {% for profile in profiles %}

          <div
            class="card absolute inset-0 w-full h-full border border-white/10 rounded-3xl shadow-2xl flex flex-col overflow-hidden"
            style="background-color: #121212; z-index: {{ loop.revindex }};" data-id="{{ profile.id }}">

            <!-- 1. Header Image (35%) -->
            <div
              class="relative w-full h-[35%] flex-shrink-0 bg-gradient-to-br from-gray-800 to-black overflow-hidden group">
              <div
                class="absolute inset-0 bg-gradient-to-b from-transparent via-[#121212]/30 to-[#121212] z-10 pointer-events-none">
              </div>

              <div class="absolute inset-x-0 bottom-0 p-5 z-20 flex flex-col justify-end">
                <h2 class="text-3xl font-bold text-white mb-2 drop-shadow-md truncate pr-2">{{ profile.display_name }}
                </h2>
                {% if profile.age or profile.location %}
                <div class="flex items-center gap-2 text-sm text-gray-200">
                  {% if profile.age %}
                  <span class="bg-white/10 backdrop-blur-md px-2.5 py-1 rounded-lg font-medium border border-white/5">{{
                    profile.age }}</span>
                  {% endif %}
                  {% if profile.location %}
                  <div
                    class="flex items-center gap-1.5 bg-black/40 px-2.5 py-1 rounded-lg backdrop-blur-sm border border-white/5">
                    <i class="fas fa-map-marker-alt text-emerald-400"></i>
                    <span class="truncate max-w-[150px]">{{ profile.location }}</span>
                  </div>
                  {% endif %}
                </div>
                {% endif %}
              </div>
            </div>

            <!-- 2. Main Content -->
            <div class="flex-1 w-full p-5 pt-2 flex flex-col gap-4 overflow-hidden relative"
              style="background-color: #121212;">

              {% if profile.bio %}
              <div class="relative">
                <p class="text-sm text-gray-300 leading-relaxed line-clamp-5">{{ profile.bio }}</p>
              </div>
              {% endif %}

              <!-- Tags -->
              {% if profile.genres %}
              <div class="flex flex-wrap gap-1.5 content-start">
                {% for genre in (profile.genres or [])[:5] %}
                <span
                  class="px-2.5 py-1 rounded-md bg-white/5 border border-white/10 text-[10px] text-gray-400 tracking-wide uppercase font-medium">{{
                  genre }}</span>
                {% endfor %}
              </div>
              {% endif %}

              <div class="mt-auto grid grid-cols-2 gap-4 pb-20">
                <!-- Artists -->
                <div class="space-y-2">
                  <h3 class="text-[10px] font-bold uppercase tracking-widest text-emerald-500/70 mb-1">Top Artists</h3>
                  <div class="flex gap-2">
                    {% for artist in (profile.top_artists or [])[:2] %}
                    <div class="w-10 h-10 rounded-lg bg-gray-800 overflow-hidden relative border border-white/5">
                      <img src="{{ artist.image or 'https://placehold.co/80x80' }}" class="w-full h-full object-cover"
                        alt="{{ artist.name }}">
                    </div>
                    {% endfor %}
                  </div>
                </div>

                <!-- Tracks -->
                <div class="space-y-2">
                  <h3 class="text-[10px] font-bold uppercase tracking-widest text-emerald-500/70 mb-1">Anthem</h3>
                  {% for track in (profile.top_tracks or [])[:1] %}
                  <div class="flex items-center gap-2 p-1.5 rounded-lg bg-white/5 border border-white/5">
                    <img src="{{ track.image or 'https://placehold.co/40x40' }}" class="w-8 h-8 rounded object-cover"
                      alt="{{ track.name }}">
                    <div class="min-w-0">
                      <p class="text-xs font-medium text-white truncate">{{ track.name }}</p>
                      <p class="text-[10px] text-gray-500 truncate">{{ track.artists[0] }}</p>
                    </div>
                  </div>
                  {% endfor %}
                </div>
              </div>
            </div>

            <!-- 3. Actions Footer -->
            <div class="absolute bottom-4 inset-x-0 px-6 flex justify-center items-center gap-6 z-30">
              <button
                class="pass w-14 h-14 rounded-full bg-[#181818] border border-red-500/20 text-red-500 hover:bg-red-500 hover:text-white hover:scale-110 transition flex items-center justify-center shadow-lg shadow-black/50"><i
                  class="fas fa-times text-2xl"></i></button>
              <button
                class="super-like w-12 h-12 rounded-full bg-[#181818] border border-blue-500/20 text-blue-500 hover:bg-blue-500 hover:text-white hover:scale-110 transition flex items-center justify-center shadow-lg shadow-black/50"><i
                  class="fas fa-star text-lg"></i></button>
              <button
                class="like w-14 h-14 rounded-full bg-[#181818] border border-emerald-500/20 text-emerald-500 hover:bg-emerald-500 hover:text-white hover:scale-110 transition flex items-center justify-center shadow-lg shadow-black/50"><i
                  class="fas fa-heart text-2xl"></i></button>
            </div>

          </div>
          {% endfor %}
          {% endif %}
        </div>
      </div>
    </section>
  </main>

  <script src="{{ url_for('static', filename='js/app.js') }}"></script>
  <script src="{{ url_for('static', filename='js/find_match.js') }}"></script>
</body>

</html>